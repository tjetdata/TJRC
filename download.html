<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Download – TJRC</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6bbb2ee3340c67b6da55fdc5589aeeb3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">TJRC</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./browse.html"> 
<span class="menu-text">Browse Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./download.html" aria-current="page"> 
<span class="menu-text">Download</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./findings.html"> 
<span class="menu-text">Findings</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./faq.html"> 
<span class="menu-text">FAQ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./feedback.html"> 
<span class="menu-text">Feedback</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./people.html"> 
<span class="menu-text">People</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./links.html"> 
<span class="menu-text">Links</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#replication-data" id="toc-replication-data" class="nav-link active" data-scroll-target="#replication-data">Replication Data</a></li>
  <li><a href="#citation-of-browse-data" id="toc-citation-of-browse-data" class="nav-link" data-scroll-target="#citation-of-browse-data">Citation of Browse Data</a></li>
  <li><a href="#coding-manuals" id="toc-coding-manuals" class="nav-link" data-scroll-target="#coding-manuals">Coding Manuals</a></li>
  <li><a href="#feedback-and-corrections" id="toc-feedback-and-corrections" class="nav-link" data-scroll-target="#feedback-and-corrections">Feedback and Corrections</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Download</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>NOTE:</strong> The data on TJRC are not all downloadable at once. TJRC researchers make various datasets to answer particular questions, and then we release those for replication and reuse. To understand in greater detail, see this excerpt from Geoff Dancy and Kathryn Sikkink, “The Data of Transitional Justice.” In preparation for <em>The Oxford Handbook of Transitional Justice</em>.</p>
<p>“What does the final database look like? This is a question worth answering because it is the source of misunderstanding. The TJRC database is not exclusively quantitative. It is also not frozen; instead, it sits in constant flux between being and becoming. For technical researchers, the database is a relational MySQL data matrix comprised of many rows and columns that sits on an online server. It contains tens of thousands of discrete pieces of information, some words and some numbers, which are separated from each other by commas. For qualitative researchers, the database also contains a wealth of narrative information about such issues as the historical origins of transitional justice policies, the names of victims and the accused in prosecutions, the scope of amnesty policies, and the mandate of the truth commissions. These data can be viewed with a built-in browse function.</p>
<p>TJRC researchers have sampled from the main database to compile offshoot events-history datasets that use additive count measures within each country-year,. This provides much richer information about the actual number of prosecutions, amnesties, truth commissions, and reparations policies in a country (Dancy et al.&nbsp;2019). These data sets also include information on the quality and outcomes of the processes. For example, we are exploring various ways to measure the robustness of truth commissions based on various observable properties of each body. This would produce something like a truth commission performance indicator” that captures variation in quality across cases.</p>
<p>The TJRC developed a relational database because of the sheer amount and variety of information that needed to be handled. There are different ways of sampling countries (democratic or post-conflict transitions), different mechanisms, and different outcomes of interest (repressive violence, democratic consolidation, etc.). With relational data, all of these data can be kept in separate rooms within the same house, and brought together when and if it is time to meet.</p>
<p>The drawback of the relational approach is that it is non-intuitive and difficult to understand. One common misconception is that the database has one single structure with unchanging content. Scholars often write to ask for a copy of the TJRC dataset, an understandable request that is also unfulfillable, technically speaking, since the database is a digitally housed collection of many datasets that can be queried to create any number of data files. This means that we have to respond to interested researchers with a question: what data would you like? Often, though, they just want to peruse, or scroll through, the data. For this reason, the TJRC’s web developers created tabbed filters that allow users to browse that data. One can automatically filter the database to view mechanisms by country, year, regime, civil war context, and crimes covered. Still, users’ most common impulse is to ask for a single complete dataset that they can view in their most preferred applications. One does not exist—nor does a single master list, or count, of transitional justice processes. What does exist, instead, are a series of data sets that the TJRC project members have sampled, extracted, and frozen in particular moments for the purpose of analysis.</p>
<p>The benefit of the relational approach to database creation—wherein a variety of pieces of information are stored online and wait for the user to fit them into a structure—is that it allows the data to remain flexible, and adaptable to purpose. One can design a data set to answer specific questions, e.g.&nbsp;Does holding more human rights prosecutions amid civil war prolong hostilities? To answer this question, one must query the database to provide list of cases in which civil war is ongoing, and accompany that list with a quantitative indicator of how many prosecutions occur amid fighting (see Dancy and Wiebelhaus-Brahm 2018). In another example, the TJRC collected data on over 6,000 records on domestic criminal prosecutions, but in our most extensive study on the impact of transitional justice in democratizing states, we include information on only 555 trials. This pruning was theory-driven. The point of this study was to analyze the impact on future patterns of repressive violence caused by more extensive efforts at prosecuting former state agents after a democratic transition (Dancy et al.&nbsp;2019). So we had to select in only those prosecutions based on context (following democratic transition), accused (whether they were state agents in the previous regime), harms (which must be human rights violations), and evidentiary validity (whether the trial event was verified by two or more sources). Theory-driven dataset generation of this type allows for the most accurate analyses of research questions. Too often in social science, scholars allow data availability to guide inquiry; one answers questions for which one possesses reliable data. This may limit progress because it means that scholars continue to pick over the same data to find minor relationships (Schrodt 2014). Overcoming this problem in the future means unfreezing information and allowing research questions to guide data set creation.”</p>
<p><em>Cited Research:</em></p>
<p>Dancy, Geoff, and Eric Wiebelhaus-Brahm. 2018. “The Impact of Criminal Prosecutions during Intrastate Conflict.” <em>Journal of Peace Research</em> 55 (1): 47–61.</p>
<p>Dancy, Geoff, Bridget Marchesi, Tricia Olsen, Leigh A. Payne, Andrew Reiter, and Kathryn Sikkink. 2019. “Behind Bars and Bargains: New Findings on Transitional Justice in Emerging Democracies.” Forthcoming, <em>International Studies Quarterly</em>.</p>
<p>Schrodt, Philip A. 2014. “Seven Deadly Sins of Contemporary Quantitative Political Analysis.” <em>Journal of Peace Research</em> 51(2): 287-300.</p>
<section id="replication-data" class="level2">
<h2 class="anchored" data-anchor-id="replication-data">Replication Data</h2>
<p>Below are the replication data for our most recent publications. They do not include the full spectrum of data availalbe to browse or query, but they are tailored to specific research questions that we have. If you would like data to answer a specific research question, email Geoff Dancy at <strong><a href="mailto:geoff.dancy@utoronto.ca">geoff.dancy@utoronto.ca</a></strong> for more information.</p>
<p>Dancy, Geoff, Bridget Marchesi, Tricia Olsen, Leigh A. Payne, Andrew Reiter, and Kathryn Sikkink. 2019. “Behind Bars and Bargains: New Findings on Transitional Justice in Emerging Democracies” Forthcoming, <em>International Studies Quarterly</em>.</p>
<p>[<a href="files/barsbargains.dta">Data</a>] [<a href="files/barsbargains_fig1.dta">Figure 1 Data</a>] [<a href="files/BarsBargains4.1_replicate.do">STATA do file</a>] [<a href="files/ReplicationMemo.rtf">Replication memo</a>]</p>
</section>
<section id="citation-of-browse-data" class="level2">
<h2 class="anchored" data-anchor-id="citation-of-browse-data">Citation of Browse Data</h2>
<p>When using any of the data drawn directly from this website, please cite to the following:</p>
<p>Dancy, Geoff, Francesca Lessa, Bridget Marchesi, Leigh A. Payne, Gabriel Pereira, and Kathryn Sikkink. 2014. “The Transitional Justice Research Collaborative Dataset” Available at &lt;www.transitionaljusticedata.com&gt;. Accessed <em>date</em>.</p>
</section>
<section id="coding-manuals" class="level2">
<h2 class="anchored" data-anchor-id="coding-manuals">Coding Manuals</h2>
<p>Democratic Transitions, 1970-2010: <a href="files/DemoTransitions.pdf">pdf</a></p>
<p>Domestic Criminal Prosecutions Coding Manual: <a href="files/TrialsCodingManual.pdf">pdf</a></p>
<p>Amnesty Coding Manual: <a href="files/AmnestyCodingManual.pdf">pdf</a></p>
<p>Truth Commission Coding Manual: <a href="files/TruthCommissionCodingManual.pdf">pdf</a></p>
</section>
<section id="feedback-and-corrections" class="level2">
<h2 class="anchored" data-anchor-id="feedback-and-corrections">Feedback and Corrections</h2>
<p>The Collaborative welcomes and encourages <a href="feedback.html">Feedback</a> from country experts. With such feedback, we hope to continue to improve the currently available data. We will review your comments, research them, verify them, and make emendations if necessary.</p>


</section>

<div style="font-size: 67%;">
<p><br>
</p>
<p>This material is based upon work supported by the National Science Foundation (Grant Nos. SES-0961226 and SES-1228519) and the Arts and Humanities Research Council (Grant Nos. AH/1500030/1 and AH/K502856/1). The Oak Foundation (Grant No.&nbsp;OCAY-11-143) supported “The Access to Justice Project: Overcoming Amnesty in the Age of Accountability.” The John Fell Oxford University Press Research Fund (Grant No.&nbsp;101/552) funded “Accounting for Amnesty: Justice for Past Atrocity.”</p>
<p>Any opinions, findings, and conclusions or recommendations expressed in this material are those of the authors and do not necessarily reflect the views of their Universities or those of the National Science Foundation or the Arts and Humanities Research Council, or the Oak Foundation.</p>
<p><a href="http://www.nsf.gov/"><img src="./images/nsf_logo.jpg" class="img-fluid" alt="National Science Foundation"></a> <a href="http://www.ahrc.ac.uk/Pages/Home.aspx"><img src="./images/ahrc.jpg" class="img-fluid" alt="Arts &amp; Humanities Research Council"></a> <a href="http://www1.umn.edu/twincities/index.html"><img src="./images/uofm.gif" class="img-fluid" alt="University of Minnesota"></a> <a href="http://www.ox.ac.uk/"><img src="./images/uoo.gif" class="img-fluid" alt="University of Oxford"></a></p>
<p><br>
</p>
<p>This site was recreated by <a href="https://oskarthoms.net">Oskar Timo Thoms</a> on behalf of TJET/TJRC with <a href="https://quarto.org/">Quarto</a> and the <a href="https://glin.github.io/reactable/">Reactable</a> package.</p>
</div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/transitionaljusticedata\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>